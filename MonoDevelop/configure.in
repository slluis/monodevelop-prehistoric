AC_INIT(README)
AC_CANONICAL_SYSTEM
AM_INIT_AUTOMAKE(monodevelop, 0.2)
AM_MAINTAINER_MODE

AM_DISABLE_STATIC
AM_PROG_LIBTOOL

AC_PATH_PROG(MONO, mono)
AC_PATH_PROG(MCS, mcs)
if test "x$MONO" = "x" ; then
  AC_MSG_ERROR([Can't find "mono" in your PATH])
fi
if test "x$MCS" = "x" ; then
  AC_MSG_ERROR([Can't find "mcs" in your PATH])
fi
AC_SUBST(PATH)
AC_SUBST(LD_LIBRARY_PATH)

dnl Find pkg-config
AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
if test "x$PKG_CONFIG" = "xno"; then
        AC_MSG_ERROR([You need to install pkg-config])
fi

dnl Find mono
MONO_REQUIRED_VERSION=0.30

PKG_CHECK_MODULES(BASE_DEPENDENCIES, mono >= $MONO_REQUIRED_VERSION, enable_mono=yes, enable_mono=no)

dnl Find gtk-sharp
GTKSHARP_REQUIRED_VERSION=0.18

PKG_CHECK_MODULES(BASE_DEPENDENCIES, gtk-sharp >= $GTKSHARP_REQUIRED_VERSION, enable_gtksharp=yes, enable_gtksharp=no) 
gtksharp_prefix=`pkg-config --variable=prefix gtk-sharp`
AC_SUBST(gtksharp_prefix)

GTKSOURCEVIEW_REQUIRED_VERSION=0.7

PKG_CHECK_MODULES(BASE_DEPENDENCIES, gtksourceview-1.0 >= $GTKSOURCEVIEW_REQUIRED_VERSION, enable_gtksourceview=yes, enable_gtksourceview=no)

GTKSOURCEVIEWSHARP_REQUIRED_VERSION=0.1
PKG_CHECK_MODULES(BASE_DEPENDENCIES, gtksourceview-sharp >= $GTKSOURCEVIEWSHARP_REQUIRED_VERSION, enable_gtksourceviewsharp=yes, enable_gtksourceviewsharp=no)
GTKSOURCEVIEW_SHARP="`pkg-config --libs gtksourceview-sharp`"
AC_SUBST(GTKSOURCEVIEW_SHARP)

dnl find gnome-vfs
GNOMEVFS_REQUIRED_VERSION=2.0
PKG_CHECK_MODULES(BASE_DEPENDENCIES, gnome-vfs-2.0 >= $GNOMEVFS_REQUIRED_VERSION, enable_gnomevfs=yes, enable_gnomevfs=no)

dnl GdlDock requirements and configuration
GTK_REQUIRED=2.2.0
LIBXML_REQUIRED=2.2.8
LIBGLADE_REQUIRED=2.0.0
PKG_CHECK_MODULES(GDLDOCK, 
	gtk+-2.0 >= $GTK_REQUIRED 
	libglade-2.0 >= $LIBGLADE_REQUIRED
	libxml-2.0 >= $LIBXML_REQUIRED)
AC_SUBST(GDLDOCK_CFLAGS)
AC_SUBST(GDLDOCK_LIBS)

dnl marshal and enum generators
GLIB_GENMARSHAL="`$PKG_CONFIG --variable=glib_genmarshal glib-2.0`"
AC_SUBST(GLIB_GENMARSHAL)
GLIB_MKENUMS="`$PKG_CONFIG --variable=glib_mkenums glib-2.0`"
AC_SUBST(GLIB_MKENUMS)


dnl should this be a hard dep?
dnl ORBIT2_REQUIRED_VERSION=2.8.3

dnl PKG_CHECK_MODULES(BASE_DEPENDENCIES, ORBit-2.0 >= $ORBIT2_REQUIRED_VERSION)

dnl find mozilla-gtkmozembed
MOZGTK_REQUIRED_VERSION=1.2
PKG_CHECK_MODULES(BASE_DEPENDENCIES, mozilla-gtkmozembed >= $MOZGTK_REQUIRED_VERSION, enable_gtkmoz=yes, enable_gtkmoz=no)

dnl find mono debugger
MONO_DEBUGGER_REQUIRED_VERSION=0.6
PKG_CHECK_MODULES(MONO_DEBUGGER, mono-debugger >= $MONO_DEBUGGER_REQUIRED_VERSION, enable_debugger=yes, enable_debugger=no)
debugger_prefix=`pkg-config --variable=prefix mono-debugger`
AC_SUBST(debugger_prefix)

dnl find monodoc
MONODOC_REQUIRED_VERSION=0.12
PKG_CHECK_MODULES(MONODOC, monodoc >= $MONODOC_REQUIRED_VERSION, enable_monodoc=yes, enable_monodoc=no)
monodoc_libflags=`pkg-config --libs monodoc`
AC_SUBST(monodoc_libflags)

MOZILLA_HOME="`$PKG_CONFIG --variable=libdir mozilla-gtkmozembed`"
AC_SUBST(MOZILLA_HOME)

gnome_prefix="`$PKG_CONFIG --variable=prefix libgnome-2.0`"
AC_SUBST(gnome_prefix)

AM_CONDITIONAL(ENABLE_DEBUGGER, test "x$enable_debugger" = "xyes")

AC_OUTPUT([
Makefile
gdldock/Makefile
gdldock/gdl/Makefile
gdldock/sources/Makefile
gdldock/sources/gdl/Makefile
gtkmozembed-sharp/Makefile
src/Makefile
src/AddIns/Makefile
src/AddIns/BackendBindings/Makefile
src/AddIns/BackendBindings/CSharpBinding/Makefile
src/AddIns/DisplayBindings/Makefile
src/AddIns/DisplayBindings/SourceEditor/Makefile
src/AddIns/Misc/Makefile
src/AddIns/Misc/StartPage/Makefile
src/AddIns/DebuggerAddIn/Makefile
src/AddIns/Nunit/Makefile
src/Main/Makefile
src/Main/Base/Makefile
src/Main/StartUp/Makefile
src/Libraries/Makefile
src/Libraries/MonoDevelop.Core/Makefile
src/Libraries/MonoDevelop.Gui.Utils/Makefile
src/Libraries/MonoDevelop.Gui.Widgets/Makefile
src/Libraries/SharpAssembly/Makefile
src/Libraries/CsVbRefactory/Makefile
src/Libraries/SharpRefactory/Makefile
build/Makefile
build/data/Makefile
build/data/resources/Makefile
build/data/options/Makefile
build/data/resources/css/Makefile
build/data/resources/icons/Makefile
build/data/resources/languages/Makefile
build/data/templates/Makefile
build/data/templates/file/Makefile
build/data/templates/file/CSharp/Makefile
build/data/templates/file/SharpDevelop/Makefile
build/data/templates/file/VBNet/Makefile
build/data/templates/project/Makefile
build/data/templates/project/CSharp/Makefile
build/data/templates/project/Java/Makefile
build/data/templates/project/Misc/Makefile
build/data/templates/project/VBNet/Makefile
build/doc/Makefile
build/AddIns/Makefile
build/AddIns/AddIns/Makefile
build/AddIns/AddIns/BackendBindings/Makefile
build/AddIns/AddIns/Misc/Makefile
build/AddIns/AddIns/Misc/StartPage/Makefile
data/Makefile
data/resources/Makefile
data/resources/glade/Makefile
monodevelop
])

echo "---"
echo "Configuration summary"
echo ""
echo "   * Installation prefix = $prefix"
echo "   * GNOME prefix = $gnome_prefix"
echo ""
echo "   * Gtk# $GTKSHARP_REQUIRED_VERSION: $enable_gtksharp"
echo "   * gnomevfs $GNOMEVFS_REQUIRED_VERSION: $enable_gnomevfs"
echo "   * gtkmozembed $MOZGTK_REQUIRED_VERSION: $enable_gtkmoz"
echo "   * gtksourceview $GTKSOURCEVIEW_REQUIRED_VERSION: $enable_gtksourceview"
echo "   * gtksourceview-sharp $GTKSOURCEVIEWSHARP_REQUIRED_VERSION: $enable_gtksourceviewsharp"
echo "   * mono $MONO_REQUIRED_VERSION: $enable_mono"
echo "   * monodoc $MONODOC_REQUIRED_VERSION: $enable_monodoc"
echo "   * mono-debugger $MONO_DEBUGGER_REQUIRED_VERSION: $enable_debugger"
echo ""
echo "   NOTE: if any of the above say 'no' you may install the"
echo "         corresponding development packages for them, and"
echo "         rerun autogen.sh. If you are sure the proper"
echo "         libraries are installed, use PKG_CONFIG_PATH to"
echo "         point to their .pc files"
echo ""
echo "---"
